DC1:::
kubectl vsphere login --insecure-skip-tls-verify --server 10.3.40.1 --tanzu-kubernetes-cluster-name et01-tkg-bigdata-prod-workload-cluster --tanzu-kubernetes-cluster-namespace et01-tkg-bigdata-prod --vsphere-username=Safaricomet\Mohd.Almas

kubectl config set-context --current --namespace=et01-tkg-bigdata-prod

DC2:::
kubectl vsphere login --server 10.3.141.1 --insecure-skip-tls-verify --tanzu-kubernetes-cluster-name et02-tkg-bigdata-prod-workload-cluster --tanzu-kubernetes-cluster-namespace et02-tkg-bigdata-prod --vsphere-username=Safaricomet\Mohd.Almas

kubectl config set-context --current --namespace=et02-tkg-bigdata-prod

wFB&9N2pku!G


kubectl vsphere logout

Safaricomet\Mohd.Almas
Safaricomet\svc-bigdata-admin
lyOdmSBwCsZnD4dLnOAE

export http_proxy=http://proxy2.safaricomet.net:3128
export https_proxy=http://proxy2.safaricomet.net:3128
export HTTP_PROXY=http://proxy2.safaricomet.net:3128
export HTTPS_PROXY=http://proxy2.safaricomet.net:3128

unset https_proxy http_proxy


Sunil.Kumar
Y4T&zcX9d(ns

kubectl config get-contexts                          # display list of contexts 
kubectl config current-context 

kubectl config set-context --current --namespace=et01-tkg-bigdata-prod
kubectl config set-context --current --namespace=ingress-nginx
kubectl config set-context --current --namespace=kafka
kubectl config set-context --current --namespace=tanzu-system-monitoring
kubectl config set-context --current --namespace=bigdata-monitoring
kubectl config set-context --current --namespace=kube-system
kubectl config set-context --current --namespace=bigdata-unison


kubectl create secret docker-registry regcred --docker-server=et01-harbor.safaricomet.net --docker-username=svc-bigdata-admin@safaricomet.net --docker-password="lyOdmSBwCsZnD4dLnOAE"



et01-tkg-bigdata-prod-workload-cluster-workers-qgbj4-98d9c6p4d9   Ready                      <none>                 37m   v1.20.12+vmware.1
et01-tkg-bigdata-prod-workload-cluster-workers-qgbj4-98d9c82kz6   Ready                      <none>                 40m   v1.20.12+vmware.1
et01-tkg-bigdata-prod-workload-cluster-workers-qgbj4-98d9cbtqzq   Ready                      <none>                 46m   v1.20.12+vmware.1
et01-tkg-bigdata-prod-workload-cluster-workers-qgbj4-98d9cd9cfk   Ready                      <none>                 26m   v1.20.12+vmware.1
et01-tkg-bigdata-prod-workload-cluster-workers-qgbj4-98d9chdtqk   Ready                      <none>                 35m   v1.20.12+vmware.1
et01-tkg-bigdata-prod-workload-cluster-workers-qgbj4-98d9cl64x8   Ready                      <none>                 29m   v1.20.12+vmware.1
et01-tkg-bigdata-prod-workload-cluster-workers-qgbj4-98d9cpzpnh   Ready                      <none>                 32m   v1.20.12+vmware.1
et01-tkg-bigdata-prod-workload-cluster-workers-qgbj4-98d9crfgh9   Ready                      <none>                 49m   v1.20.12+vmware.1


kubectl taint nodes et01-tkg-bigdata-prod-workload-cluster-workers-qgbj4-98d9c6p4d9  dedicated=Kafka-Nifi:NoSchedule
kubectl label nodes et01-tkg-bigdata-prod-workload-cluster-workers-qgbj4-98d9c6p4d9  dedicated=Kafka-Nifi
kubectl taint nodes et01-tkg-bigdata-prod-workload-cluster-workers-qgbj4-98d9c82kz6  dedicated=Kafka-Nifi:NoSchedule
kubectl label nodes et01-tkg-bigdata-prod-workload-cluster-workers-qgbj4-98d9c82kz6  dedicated=Kafka-Nifi
kubectl taint nodes et01-tkg-bigdata-prod-workload-cluster-workers-qgbj4-98d9cbtqzq  dedicated=Kafka-Nifi:NoSchedule
kubectl label nodes et01-tkg-bigdata-prod-workload-cluster-workers-qgbj4-98d9cbtqzq  dedicated=Kafka-Nifi


kubectl taint nodes et01-tkg-bigdata-prod-workload-cluster-workers-qgbj4-98d9cd9cfk  dedicated=Hadoop:NoSchedule
kubectl label nodes et01-tkg-bigdata-prod-workload-cluster-workers-qgbj4-98d9cd9cfk  dedicated=Hadoop
kubectl taint nodes et01-tkg-bigdata-prod-workload-cluster-workers-qgbj4-98d9chdtqk  dedicated=Hadoop:NoSchedule
kubectl label nodes et01-tkg-bigdata-prod-workload-cluster-workers-qgbj4-98d9chdtqk  dedicated=Hadoop
kubectl taint nodes et01-tkg-bigdata-prod-workload-cluster-workers-qgbj4-98d9cl64x8  dedicated=Hadoop:NoSchedule
kubectl label nodes et01-tkg-bigdata-prod-workload-cluster-workers-qgbj4-98d9cl64x8  dedicated=Hadoop


sed -i '/# %wheel/c\%wheel        ALL=(ALL)       NOPASSWD: ALL' /etc/sudoers
usermod --append -G wheel mohd.almas

      {{- if .Values.tolerations }}
      tolerations: {{- include "common.tplvalues.render" (dict "value" .Values.tolerations "context" $) | nindent 8 }}
      {{- end }}
	  {{- if .Values.affinity }}
      affinity: {{- include "common.tplvalues.render" (dict "value" .Values.affinity "context" $) | nindent 8 }}
      {{- else }}
        ()
        tolerations:
        - key: "dedicated"
          operator: "Equal"
          value: "Kafka-Nifi"
          effect: "NoSchedule"
        affinity:
		()
          nodeAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              nodeSelectorTerms:
              - matchExpressions:
                - key: dedicated
                  operator: In
                  values:
                  - Kafka-Nifi


docker login et01-harbor.safaricomet.net --username Mohd.Almas@safaricomet.net --password 'wFB&9N2pku!G'
docker logout

docker pull mohdalmasansari/hadoop-redhat:hadoop-3.1.1-hbase-2.0.2-phoenix-5.0.0
docker pull mohdalmasansari/hive-spark:hive-3.1.0-spark-2.3.0-scala-2.11.6
docker pull docker.io/bitnami/postgresql:11.10.0-debian-10-r83
docker pull quay.io/strimzi/kafka:0.27.1-kafka-3.0.0
docker pull kapkiai/nifi@sha256:7be438fcb8a74249d3799c8b7f9020d2ccf484625689f45d802a3249ac305667
docker pull busybox:latest
docker pull mohdalmasansari/spark:spark-3.2.0-scala-2.12.0
docker pull zookeeper:3.5.5
docker pull k8s.gcr.io/ingress-nginx/controller:v1.1.2@sha256:28b11ce69e57843de44e3db6413e98d09de0f6688e33d4bd384002a44f78405c
docker pull k8s.gcr.io/ingress-nginx/kube-webhook-certgen:v1.1.1@sha256:64d8c73dca984af206adf9d6d7e46aa550362b1d7a01f3a0a91b20cc67868660
docker pull quay.io/strimzi/operator:0.27.1
docker pull kapkiai/nifi-toolkit:1.15.1
docker pull mohdalmasansari/jupyterhub:v2.1.0-beta-ubi8.5
docker pull docker.io/provectuslabs/kafka-ui:8d10eb69e8b91cf6b807cdba3f68f038efa931fc 
docker pull quay.io/strimzi/kafka-bridge:0.21.3
docker pull quay.io/strimzi/jmxtrans:0.27.1
docker pull quay.io/strimzi/kaniko-executor:0.27.1
docker pull quay.io/strimzi/maven-builder:0.27.1
docker pull apache/druid:0.22.1


docker tag mohdalmasansari/hadoop-redhat:hadoop-3.1.1-hbase-2.0.2-phoenix-5.0.0                 et01-harbor.safaricomet.net/bigdata/hadoop-redhat:hadoop-3.1.1-hbase-2.0.2-phoenix-5.0.0
docker tag mohdalmasansari/hive-spark:hive-3.1.0-spark-2.3.0-scala-2.11.6                       et01-harbor.safaricomet.net/bigdata/hive-spark:hive-3.1.0-spark-2.3.0-scala-2.11.6
docker tag bitnami/postgresql:11.10.0-debian-10-r83                                             et01-harbor.safaricomet.net/bigdata/postgresql:11.10.0-debian-10-r83
docker tag quay.io/strimzi/kafka:0.27.1-kafka-3.0.0                                             et01-harbor.safaricomet.net/bigdata/strimzi/kafka:0.27.1-kafka-3.0.0
docker tag kapkiai/nifi@sha256:7be438fcb8a74249d3799c8b7f9020d2ccf484625689f45d802a3249ac305667 et01-harbor.safaricomet.net/bigdata/nifi:1.15.10
docker tag busybox:latest                                                                       et01-harbor.safaricomet.net/bigdata/busybox:latest
docker tag mohdalmasansari/spark:spark-3.2.0-scala-2.12.0                                       et01-harbor.safaricomet.net/bigdata/spark:spark-3.2.0-scala-2.12.0
docker tag zookeeper:3.5.5                                                                      et01-harbor.safaricomet.net/bigdata/zookeeper:3.5.5
docker tag k8s.gcr.io/ingress-nginx/controller:v1.1.2@sha256:28b11ce69e57843de44e3db6413e98d09de0f6688e33d4bd384002a44f78405c et01-harbor.safaricomet.net/bigdata/nginx-controller:1.1.2
docker tag k8s.gcr.io/ingress-nginx/kube-webhook-certgen:v1.1.1@sha256:64d8c73dca984af206adf9d6d7e46aa550362b1d7a01f3a0a91b20cc67868660 et01-harbor.safaricomet.net/bigdata/nginx-kube-webhook-certgen:v1.1.1
docker tag quay.io/strimzi/operator:0.27.1 et01-harbor.safaricomet.net/bigdata/strimzi-operator:0.27.1
docker tag kapkiai/nifi-toolkit:1.15.1 et01-harbor.safaricomet.net/bigdata/nifi-toolkit:1.15.1
docker tag mohdalmasansari/jupyterhub:v2.1.0-beta-ubi8.5 et01-harbor.safaricomet.net/bigdata/jupyterhub:v2.1.0-beta-ubi8.5
docker tag provectuslabs/kafka-ui:8d10eb69e8b91cf6b807cdba3f68f038efa931fc  et01-harbor.safaricomet.net/bigdata/kafka-ui:8d10eb69e8b91cf6b807cdba3f68f038efa931fc  
docker tag quay.io/strimzi/kafka-bridge:0.21.3    et01-harbor.safaricomet.net/bigdata/strimzi/kafka-bridge:0.21.3 
docker tag quay.io/strimzi/jmxtrans:0.27.1        et01-harbor.safaricomet.net/bigdata/strimzi/jmxtrans:0.27.1
docker tag quay.io/strimzi/kaniko-executor:0.27.1 et01-harbor.safaricomet.net/bigdata/strimzi/kaniko-executor:0.27.1
docker tag quay.io/strimzi/maven-builder:0.27.1   et01-harbor.safaricomet.net/bigdata/strimzi/maven-builder:0.27.1
docker tag apache/druid:0.22.1   et01-harbor.safaricomet.net/bigdata/strimzi/maven-builder:0.27.1

docker push et01-harbor.safaricomet.net/bigdata/hadoop-redhat:hadoop-3.1.1-hbase-2.0.2-phoenix-5.0.0
docker push et01-harbor.safaricomet.net/bigdata/hive-spark:hive-3.1.0-spark-2.3.0-scala-2.11.6
docker push et01-harbor.safaricomet.net/bigdata/postgresql:11.10.0-debian-10-r83
docker push et01-harbor.safaricomet.net/bigdata/strimzi/kafka:0.27.1-kafka-3.0.0
docker push et01-harbor.safaricomet.net/bigdata/nifi:1.15.10
docker push et01-harbor.safaricomet.net/bigdata/busybox:latest
docker push et01-harbor.safaricomet.net/bigdata/spark:spark-3.2.0-scala-2.12.0
docker push et01-harbor.safaricomet.net/bigdata/zookeeper:3.5.5
docker push et01-harbor.safaricomet.net/bigdata/nginx-controller:1.1.2
docker push et01-harbor.safaricomet.net/bigdata/nginx-kube-webhook-certgen:v1.1.1
docker push et01-harbor.safaricomet.net/bigdata/strimzi-operator:0.27.1
docker push et01-harbor.safaricomet.net/bigdata/nifi-toolkit:1.15.1
docker push et01-harbor.safaricomet.net/bigdata/jupyterhub:v2.1.0-beta-ubi8.5
docker push et01-harbor.safaricomet.net/bigdata/kafka-ui:8d10eb69e8b91cf6b807cdba3f68f038efa931fc
docker push et01-harbor.safaricomet.net/bigdata/strimzi/kafka-bridge:0.21.3 
docker push et01-harbor.safaricomet.net/bigdata/strimzi/jmxtrans:0.27.1
docker push et01-harbor.safaricomet.net/bigdata/strimzi/kaniko-executor:0.27.1
docker push et01-harbor.safaricomet.net/bigdata/strimzi/maven-builder:0.27.1


docker pull apache/druid:0.22.1
docker tag apache/druid:0.22.1   et01-harbor.safaricomet.net/bigdata/druid:0.22.1
docker push et01-harbor.safaricomet.net/bigdata/druid:0.22.1
docker pull kenchir/postgres:11.10.0-v2
docker tag kenchir/postgres:11.10.0-v2 et01-harbor.safaricomet.net/bigdata/postgresql:11.10.0-debian-10-r83
docker push et01-harbor.safaricomet.net/bigdata/postgresql:11.10.0-debian-10-r83




Druid Authorization::
curl -i -v  -H "Content-Type: application/json" -u svc-bigdata-admin -X POST http://druid-coordinator-0.druid-coordinator.et01-tkg-bigdata-prod.svc.cluster.local:8081/druid-ext/basic-security/authentication/db/ldap/users/Alphonce.Oniala 

curl -i -v  -H "Content-Type: application/json" -u svc-bigdata-admin -X POST http://druid-coordinator-0.druid-coordinator.et01-tkg-bigdata-prod.svc.cluster.local:8081/druid-ext/basic-security/authorization/db/ldapauth/users/Kenneth.Kipkogei 
curl -i -v  -H "Content-Type: application/json" -u svc-bigdata-admin -X POST http://druid-coordinator-0.druid-coordinator.et01-tkg-bigdata-prod.svc.cluster.local:8081/druid-ext/basic-security/authorization/db/ldapauth/users/Kenneth.Kipkogei/roles/admin 



PSQL after LDAP:::
for Authorization:::-->
CREATE ROLE "svc-bigdata-admin" WITH SUPERUSER CREATEDB CREATEROLE INHERIT LOGIN;
GRANT ALL PRIVILEGES ON DATABASE metastore TO "svc-bigdata-admin";
GRANT ALL PRIVILEGES ON DATABASE nifireg TO "svc-bigdata-admin";
GRANT ALL PRIVILEGES ON DATABASE druid TO "svc-bigdata-admin";
GRANT ALL PRIVILEGES ON DATABASE sce TO "svc-bigdata-admin";
